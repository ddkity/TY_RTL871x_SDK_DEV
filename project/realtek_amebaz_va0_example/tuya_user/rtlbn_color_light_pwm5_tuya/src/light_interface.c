#include "tuya_device.h"
#include "adapter_platform.h"
#include "tuya_cloud_error_code.h"
#include "tuya_iot_wifi_api.h"
#include "tuya_cloud_types.h"
#include "tuya_led.h"
#include "tuya_uart.h"
#include "tuya_gpio.h"
#include "tuya_key.h"
#include "uni_time_queue.h"
#include "gw_intf.h"
#include "uni_log.h"
#include "uni_thread.h"
#include "sys_api.h"
#include "gpio_test.h"
#include "pwmout_api.h"
#include "timer_api.h"


#include "light_driver.h"
#include "light_handler.h"
#include "light_config.h" 
#include "light_prod_test.h"



static unsigned char gamma_8_correction[]={0,0,1,1,1,2,2,3,3,4,4,5,6,6,7,7,8,9,9,10,11,11,12,13,13,
								  14,15,15,16,17,18,18,19,20,21,21,22,23,24,24,25,26,27,28,
								  28,29,30,31,32,32,33,34,35,36,37,37,38,39,40,41,42,43,44,
								  44,45,46,47,48,49,50,51,52,52,53,54,55,56,57,58,59,60,61,
								  62,63,64,65,66,66,67,68,69,70,71,72,73,74,75,76,77,78,79,
								  80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,
								  99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,
								  115,116,117,118,119,121,122,123,124,125,126,127,128,129,130,
								  131,132,134,135,136,137,138,139,140,141,142,144,145,146,147,
								  148,149,150,151,152,154,155,156,157,158,159,160,162,163,164,
								  165,166,167,168,170,171,172,173,174,175,177,178,179,180,181,
								  182,184,185,186,187,188,189,191,192,193,194,195,196,198,199,
								  200,201,202,204,205,206,207,208,210,211,212,213,214,216,217,
								  218,219,220,222,223,224,225,227,228,229,230,231,233,234,235,
								  236,238,239,240,241,243,244,245,246,248,249,250,251,253,254,255};

static unsigned char gamma_6_70_correction[]={0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,
								  4,5,5,5,6,6,6,7,7,7,7,8,8,8,9,9,10,10,10,11,11,11,12,12,
								  13,13,13,14,14,15,15,16,16,16,17,17,18,18,19,19,20,20,21,
								  21,22,22,23,23,24,24,25,25,26,26,27,27,28,29,29,30,30,31,
								  31,32,33,33,34,34,35,36,36,37,38,38,39,39,40,41,41,42,43,
								  43,44,45,45,46,47,47,48,49,49,50,51,52,52,53,54,54,55,56,
								  57,57,58,59,60,60,61,62,63,63,64,65,66,66,67,68,69,70,70,
								  71,72,73,74,75,75,76,77,78,79,80,80,81,82,83,84,85,86,86,
								  87,88,89,90,91,92,93,94,94,95,96,97,98,99,100,101,102,103,
								  104,105,106,106,107,108,109,110,111,112,113,114,115,116,117,
								  118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,
								  133,134,135,136,137,139,140,141,142,143,144,145,146,147,148,
								  149,150,151,152,154,155,156,157,158,159,160,161,162,164,165,
								  166,167,168,169,170,172,173,174,175,176,177,179};

static unsigned char gamma_6_75_correction[]={0,0,0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,5,
									 5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,11,11,11,12,12,13,13,
									 14,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,
									 23,23,24,24,25,25,26,27,27,28,28,29,29,30,31,31,32,32,33,
									 34,34,35,36,36,37,38,38,39,40,40,41,42,42,43,44,44,45,46,
									 46,47,48,49,49,50,51,51,52,53,54,54,55,56,57,58,58,59,60,
									 61,61,62,63,64,65,65,66,67,68,69,70,70,71,72,73,74,75,76,
									 76,77,78,79,80,81,82,83,83,84,85,86,87,88,89,90,91,92,93,
									 94,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,
									 109,110,111,112,113,114,115,116,117,118,119,120,121,122,
									 123,124,125,127,128,129,130,131,132,133,134,135,136,137,
									 138,139,141,142,143,144,145,146,147,148,150,151,152,153,
									 154,155,156,158,159,160,161,162,163,165,166,167,168,169,
									 170,172,173,174,175,176,178,179,180,181,183,184,185,186,
									 188,189,190,191};

unsigned char color_read_correct(unsigned char red)
{
    return gamma_8_correction[red];
}

unsigned char color_green_correct(unsigned char green)
{
    return gamma_6_70_correction[green];
}

unsigned char color_blue_correct(unsigned char blue)
{
    return gamma_6_70_correction[blue];
}

VOID send_light_data(u8 R_value, u8 G_value, u8 B_value, u8 CW_value, u8 WW_value)
{

    PR_NOTICE("R:%d G:%d B:%d c:%d w:%d", R_value, G_value, B_value, CW_value, WW_value);
//    light_pwm_send_data(R_value, G_value, B_value, CW_value, WW_value);

#if 1
    BYTE_T value[5] = {0xff,0xff,0xff};
    value[0] = R_value;
    value[1] = G_value;
    value[2] = B_value;
    value[3] = CW_value;
    value[4] = WW_value;
    
    light_sm16726b_send_data(LIGHT_I2C_SDA0, LIGHT_I2C_SCL0, value, 3);

    light_pwm_send_data(value + 3, 2);
#endif
}

VOID light_hardware_init(VOID)
{
    light_drv_pwm_init();
 
    light_drv_i2c_init(LIGHT_I2C_SDA0, LIGHT_I2C_SCL0);
}

